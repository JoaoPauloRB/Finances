@using Features.Categories
@using Features.Accounts
@using Features.FinancialTransactions
@using Web.Components.Modal;
@using Domain.Models;
@using Domain.Enums;
@inject HttpClient Http

@inherits BlazorStateComponent

<Modal @ref="@modal" Title="@(model.Type == FinancialTransactionType.Credit ? "Receita" : "Despesa")">
  <EditForm Model="@model" OnValidSubmit="@OnSubmit">
    <div class="form-group">
      <label for="description">Descrição</label>
      <InputText id="description" @bind-Value="model.Description" class="form-control"/>
    </div>
    <div class="form-group">
      <label for="amount">Valor</label>
      <InputNumber id="amount" @bind-Value="model.Amount" class="form-control"/>
    </div>
    <div class="form-group">
      <label for="category">Categoria</label>
      <InputSelect @bind-Value="model.CategoryId" id="category" class="form-control">
        <option>
          Selecione
        </option>
        @if(CategoryState.Categories != null) {
          @foreach (Category category in CategoryState.Categories)
          {
            <option value=@category.CategoryId>
              @category.Description
            </option>
          }
        }     
      </InputSelect>
    </div>
    <div class="form-group">
      <label for="account">Conta</label>
      <InputSelect @bind-Value="model.AccountId" id="account" class="form-control">
        <option>
          Selecione
        </option>
        @if(AccountState.accounts != null) {
          @foreach (Account account in AccountState.accounts)
          {
            <option value=@account.AccountId>
              @account.Description
            </option>
          }
        }     
      </InputSelect>
    </div>
    <div class="footer-buttons">
      <button @onclick="@modal.Close" type="button" class="btn btn-secondary">Cancelar</button>
      <button type="submit" class="btn btn-primary">Confirmar</button>
    </div>
  </EditForm>
</Modal>

@code {
    AccountState AccountState => GetState<AccountState>();
    CategoryState CategoryState => GetState<CategoryState>();
    FinancialTransaction model = new FinancialTransaction();
    public Modal modal = new Modal();

    private void OnSubmit() {
      Mediator.Send(new FinancialTransactionState.AddFinancialTransactionAction(model));
      model = new FinancialTransaction();
      modal.Close();
    }

    public void Open(FinancialTransactionType type) {
      model.Type = type;
      modal.Show();
      StateHasChanged();
    }
}